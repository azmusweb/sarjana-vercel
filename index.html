<script>
// Ambil konfigurasi dari sheet Config
const configSheet = "Config";
const configURL = `https://docs.google.com/spreadsheets/d/${spreadsheetID}/gviz/tq?tqx=out:json&sheet=${configSheet}`;

fetch(configURL)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    const config = {};
    json.table.rows.forEach(row => {
      const fungsi = row.c[0]?.v;
      const nilai = row.c[1]?.v;
      if (fungsi && nilai) {
        config[fungsi.trim()] = nilai.trim();
      }
    });

    // Terapkan warna tema
    if (config["warna"]) {
      document.documentElement.style.setProperty('--warna-utama', config["warna"]);
      document.querySelector("header").style.background = config["warna"];
      document.querySelector("footer").style.background = config["warna"];
      document.querySelector("nav").style.background = config["warna"];
    }

    // Ganti logo
    if (config["logo"]) {
      const logoImg = document.querySelector("header img");
      const favicon = document.querySelector("link[rel='icon']");
      if (logoImg) logoImg.src = config["logo"];
      if (favicon) favicon.href = config["logo"];
      const footerLogo = document.querySelector("footer img");
      if (footerLogo) footerLogo.src = config["logo"];
    }

    // Menu dinamis dari config
    if (config["menu"]) {
      try {
        const nav = document.getElementById("main-menu");
        nav.innerHTML = ""; // Kosongkan menu sebelumnya
        const menuList = JSON.parse(config["menu"]);
        menuList.forEach(menu => {
          if (typeof menu === "string") {
            nav.innerHTML += `<a href="/${menu.toLowerCase()}">${menu}</a>`;
          } else if (typeof menu === "object") {
            const submenu = Object.entries(menu)[0];
            const title = submenu[0];
            const links = submenu[1];
            const submenuHTML = links.map(link => `<a href="/${link.toLowerCase()}">${link}</a>`).join("");
            nav.innerHTML += `
              <a href="#" class="has-sub">${title}
                <div class="submenu">${submenuHTML}</div>
              </a>`;
          }
        });
      } catch (e) {
        console.warn("Format menu tidak valid di CONFIG:", e);
      }
    }

    // Ganti judul halaman
    if (config["judul"]) {
      document.title = config["judul"];
      document.querySelector("header h1").innerHTML = `<img src="${config["logo"]}" style="height:40px;vertical-align:middle" alt="logo"> ${config["judul"]}`;
    }
  });
</script>
