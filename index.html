<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="site-title">Sarjana</title>
  <meta name="description" content="" id="meta-description" />
  <link rel="icon" href="" id="favicon" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Tambahkan CSS tambahan di sini jika diperlukan */
    /* Contoh: Sticky sidebar */
    .sidebar {
      position: sticky;
      top: 0;
    }
  </style>
</head>
<body>
  <header>
    <img id="logo" src="" alt="Logo" />
    <nav id="main-menu">
      <!-- Menu akan diisi secara dinamis -->
    </nav>
  </header>

  <main>
    <aside class="sidebar" id="left-sidebar">
      <!-- Sidebar kiri akan diisi secara dinamis -->
    </aside>

    <section id="content">
      <!-- Konten berita akan diisi secara dinamis -->
    </section>

    <aside class="sidebar" id="right-sidebar">
      <!-- Sidebar kanan akan diisi secara dinamis -->
    </aside>
  </main>

  <footer id="footer">
    <!-- Footer akan diisi secara dinamis -->
  </footer>

  <script>
    const apiKey = 'AIzaSyDKOClQy1z23Hwjr9HyHmzJbuaPE9Ccbv4';
    const spreadsheetId = '1oMHeKOF2_D6deuV8T1l10_GB0wgsPGLV7WrPcJ6Qxww';

    // Fungsi untuk mengambil data dari Google Sheets
    async function fetchSheetData(sheetName) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();
      return data.values;
    }

    // Fungsi untuk mengonversi judul menjadi slug
    function generateSlug(text) {
      return text
        .toString()
        .toLowerCase()
        .replace(/\s+/g, '-')           // Ganti spasi dengan -
        .replace(/[^\w\-]+/g, '')       // Hapus karakter non-word
        .replace(/\-\-+/g, '-')         // Ganti multiple - dengan single -
        .replace(/^-+/, '')             // Hapus - di awal
        .replace(/-+$/, '');            // Hapus - di akhir
    }

    // Fungsi untuk memuat konfigurasi dari sheet 'Config'
    async function loadConfig() {
      const configData = await fetchSheetData('Config');
      const headers = configData[0];
      const values = configData[1];
      const config = {};
      headers.forEach((header, index) => {
        config[header] = values[index];
      });

      // Atur elemen-elemen berdasarkan konfigurasi
      document.getElementById('site-title').textContent = config['Site Title'] || 'Sarjana';
      document.getElementById('meta-description').setAttribute('content', config['Meta Description'] || '');
      document.getElementById('favicon').setAttribute('href', config['Favicon URL'] || '');
      document.getElementById('logo').setAttribute('src', config['Logo URL'] || '');

      // Atur warna tema jika tersedia
      if (config['Primary Color']) {
        document.documentElement.style.setProperty('--primary-color', config['Primary Color']);
      }

      // Atur footer
      document.getElementById('footer').innerHTML = config['Footer HTML'] || '';
    }

    // Fungsi untuk memuat menu dari sheet 'Config'
    async function loadMenu() {
      const configData = await fetchSheetData('Config');
      const headers = configData[0];
      const values = configData[1];
      const config = {};
      headers.forEach((header, index) => {
        config[header] = values[index];
      });

      const menuContainer = document.getElementById('main-menu');
      if (config['Menu']) {
        const menuItems = config['Menu'].split(';');
        menuItems.forEach(item => {
          const [name, link] = item.split(',');
          const menuItem = document.createElement('a');
          menuItem.href = link.trim();
          menuItem.textContent = name.trim();
          menuContainer.appendChild(menuItem);
        });
      }
    }

    // Fungsi untuk memuat berita dari sheet 'Live Website'
    async function loadNews() {
      const newsData = await fetchSheetData('Live Website');
      const headers = newsData[0];
      const newsItems = newsData.slice(1);

      const contentContainer = document.getElementById('content');
      newsItems.forEach(item => {
        const news = {};
        headers.forEach((header, index) => {
          news[header] = item[index];
        });

        const article = document.createElement('article');
        const slug = generateSlug(news['Judul']);

        article.innerHTML = `
          <h2><a href="/${slug}">${news['Judul']}</a></h2>
          <p><em>${news['Tanggal']}</em></p>
          <img src="${news['Gambar']}" alt="${news['Judul']}" />
          <p>${news['Isi'].substring(0, 200)}...</p>
        `;

        contentContainer.appendChild(article);
      });
    }

    // Fungsi untuk memuat sidebar (jika ada)
    async function loadSidebars() {
      const configData = await fetchSheetData('Config');
      const headers = configData[0];
      const values = configData[1];
      const config = {};
      headers.forEach((header, index) => {
        config[header] = values[index];
      });

      if (config['Left Sidebar HTML']) {
        document.getElementById('left-sidebar').innerHTML = config['Left Sidebar HTML'];
      }

      if (config['Right Sidebar HTML']) {
        document.getElementById('right-sidebar').innerHTML = config['Right Sidebar HTML'];
      }
    }

    // Inisialisasi halaman
    async function init() {
      await loadConfig();
      await loadMenu();
      await loadSidebars();
      await loadNews();
    }

    // Jalankan inisialisasi saat halaman dimuat
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
